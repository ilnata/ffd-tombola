<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sito Mobile Base</title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <script type="text/javascript" src="/javascripts/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="/javascripts/socket.io.js"></script>
    <style>
        /* 2. RESET E IMPOSTAZIONI BASE */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            /* Font di sistema per massima leggibilità su ogni OS */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f4f4f4;
            padding-bottom: 20px;
        }

        /* 3. ELEMENTI RESPONSIVE */
        img {
            max-width: 100%; /* L'immagine non uscirà mai dallo schermo */
            height: auto;
            display: block;
            border-radius: 8px;
        }

        /* Container per dare margini ai lati su mobile */
        .container {
            width: 90%;
            max-width: 600px; /* Su desktop non diventa troppo largo */
            margin: 0 auto;
        }

        /* 4. HEADER E NAVIGAZIONE */
        header {
            background-color: #fff;
            padding: 15px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        nav ul {
            list-style: none;
            text-align: center;
        }

        nav ul li {
            display: inline-block;
            margin: 0 10px;
        }

        nav a {
            text-decoration: none;
            color: #007BFF;
            font-weight: bold;
            font-size: 16px; /* Dimensione leggibile */
        }

        /* 5. SEZIONE HERO (BENVENUTO) */
        .hero {
            text-align: center;
            padding: 40px 20px;
            background-color: #fff;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .hero h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        /* 6. BOTTONI "TOUCH-FRIENDLY" */
        .btn {
            display: inline-block;
            background-color: #007BFF;
            color: white;
            padding: 12px 24px; /* Area cliccabile ampia */
            text-decoration: none;
            border-radius: 5px;
            font-size: 16px;
            margin-top: 15px;
            transition: background 0.3s;
        }

        .btn:active {
            background-color: #0056b3; /* Feedback visivo al tocco */
        }

        /* 7. CONTENUTO */
        .content {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            font-size: 0.9rem;
            color: #666;
        }
    </style>
</head>
  <body>

  <div id="main_estrattore_container">
      <div id="estrattore_container">
        <input type="number" name="numero" id="numero" />

      </div>
      <div id="risultati">
          <div id="totali"></div>
          <div id="tombole"></div>
          <div id="cinquine"></div>
      </div>
      <div id="estrattore_container2">
          <input type="text" name="cancella" id="cancella" placeholder="CANCELLA" />
      </div>


      <div id="estrattore_container3">
          <div 
          style="width: 300px; background-color: #DDD; border: 1px solid #BBB; height: 50px; text-align: center; padding-top: 10px; text-align: center; cursor: pointer;"
          id="pulisci_tabellone" class="pulisci_tabellone" >Pulisci tabellone</div>
      </div>

  </div>
  <script type="text/javascript">

      function sortNumber(a, b) {
          return a - b;
      }

      $('#pulisci_tabellone').bind('click', function(e){
        $.ajax({
            url: "/pulisci_tabellone",
            type: "POST",
            dataType: 'json',
            data: {},
            success: function(data){
                window.location.reload();
            }
        })
      })


      $('#numero').bind('keyup', function(e){

          if(e.keyCode == 13){

            let numero = Number($(this).val());
            if (numero>0 && numero<91){
                $.ajax({
                    url: "/estratto",
                    type: "POST",
                    dataType: 'json',
                    data: {numero: numero},
                    success: function(data){
                        $('#numero').val("");
                        $('#totali').html('<div>TOMBOLE: '+ (data.tombole?data.tombole.length:0) + ' CINQUINE: '+ (data.cinquine?data.cinquine.length:0)+'</div>' );
                        if (data.tombole && data.tombole.length>0) {
                            $('#tombole').html("<div>"+(data.tombole.map(function(t){return Number(t.code)})).sort(sortNumber).join(" | ")+"</div>")

                        }
                        if (data.cinquine && data.cinquine.length>0) {
                            $('#cinquine').html("<div>" + (data.cinquine.map(function (c) {
                                return Number(c.code)
                            })).sort(sortNumber).join(" | ") + "</div>")
                        }
                    }
                })
            }
              $('#numero').val("");
          }
      })

      $('#cancella').bind('keyup', function(e){

          if(e.keyCode == 13){

              let numero = Number($(this).val());
              if (numero>0 && numero<91){
                  $.ajax({
                      url: "/cancellaestratto",
                      type: "POST",
                      dataType: 'json',
                      data: {numero: numero},
                      success: function(data){
                          $('#cancella').val("");
                          $('#totali').html('<div>TOMBOLE: <strong>'+ (data.tombole?data.tombole.length:0) + '</strong> CINQUINE: <strong>'+ (data.cinquine?data.cinquine.length:0)+'</strong></div>' );
                          if (data.tombole && data.tombole.length>0) {
                              $('#tombole').html("<div>"+(data.tombole.map(function(t){return Number(t.code)})).sort(sortNumber).join(" | ")+"</div>")

                          }
                          if (data.cinquine && data.cinquine.length>0) {
                              $('#cinquine').html("<div>" + (data.cinquine.map(function (c) {
                                  return Number(c.code)
                              })).sort(sortNumber).join(" | ") + "</div>")
                          }

                      }
                  })
              }
              $('#cancella').val("");
          }
      })
      var socket = io("https://tombola-socket.marconatalini.it");

    socket.on('estratto', function(data){
        $('[data-num='+data.numero+']').addClass('extracted');
    })
  </script>
  </body>
</html>
